---
title: "Analysis Notebook"
output: html_notebook
---

```{r}
library(tidyverse)
```

## Percentage of packages that type check

Load the CSV that lists every package for all datasets, and whether it type checked under DeepTyper, LambdaNet, and InCoder.

```{r}
summary_tbl <- read_csv("../data/notes/typecheck_summary.csv", col_types = "cciii") %>%
  rename(dataset = 1, package = 2, dt = 3, ln = 4, ic = 5)
```

Filter out NAs and for each system and dataset, compute the number of packages that type check, the total number of packages, and the percentage of package that type check.

```{r}
dt_pct <- summary_tbl %>%
  group_by(dataset) %>%
  filter(!is.na(dt)) %>%
  summarize(dt.typechecks = sum(dt), dt.n = n(), dt.pct = dt.typechecks / dt.n * 100)

ln_pct <- summary_tbl %>%
  group_by(dataset) %>%
  filter(!is.na(ln)) %>%
  summarize(ln.typechecks = sum(ln), ln.n = n(), ln.pct = ln.typechecks / ln.n * 100)

ic_pct <- summary_tbl %>%
  group_by(dataset) %>%
  filter(!is.na(ic)) %>%
  summarize(ic.typechecks = sum(ic), ic.n = n(), ic.pct = ic.typechecks / ic.n * 100)
```

Summarize everything in a single table.

```{r}
typechecks_pct <- dt_pct %>%
  inner_join(ln_pct, by = "dataset") %>%
  inner_join(ic_pct, by = "dataset")
typechecks_pct
```

## Percentage of files that type check

```{r}
dt.errors_per_file <- read_csv("../data/notes/DeepTyper/errors_per_file.csv", col_types = "ccci") %>%
  rename(dataset = 1, package = 2, file = 3, dt = 4)
dt_files <- dt.errors_per_file %>%
  group_by(dataset) %>%
  summarize(dt.no_errors = sum(dt == 0), dt.n = n(), dt.pct = dt.no_errors / dt.n * 100)

ln.errors_per_file <- read_csv("../data/notes/LambdaNet/errors_per_file.csv", col_types = "ccci") %>%
  rename(dataset = 1, package = 2, file = 3, ln = 4)
ln_files <- ln.errors_per_file %>%
  group_by(dataset) %>%
  summarize(ln.no_errors = sum(ln == 0), ln.n = n(), ln.pct = ln.no_errors / ln.n * 100)

ic.errors_per_file <- read_csv("../data/notes/InCoder/errors_per_file.csv", col_types = "ccci") %>%
  rename(dataset = 1, package = 2, file = 3, ic = 4)
ic_files <- ic.errors_per_file %>%
  group_by(dataset) %>%
  summarize(ic.no_errors = sum(ic == 0), ic.n = n(), ic.pct = ic.no_errors / ic.n * 100)
```

Summarize everything in a single table.

```{r}
files_no_errors_pct <- dt_files %>%
  inner_join(ln_files, by = "dataset") %>%
  inner_join(ic_files, by = "dataset")
files_no_errors_pct
```